// Prisma Schema for Cloud Shop Simulator Admin System

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 管理员表
model Admin {
  id        String   @id @default(cuid())
  phone     String   @unique
  password  String
  name      String
  role      String   @default("admin") // admin, super_admin
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  lastLogin DateTime?
}

// 用户表
model User {
  id            String   @id @default(cuid())
  userId        String   @unique // 前端生成的用户ID
  phone         String?  // 用户手机号（可选）
  registerTime  DateTime @default(now())
  lastActive    DateTime @default(now())
  simulationCount Int    @default(0) // 模拟次数
  simulations    ShopSimulation[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([userId])
  @@index([phone])
}

// 店铺模拟数据表
model ShopSimulation {
  id                String   @id @default(cuid())
  userId            String
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  level             String   // bronze, silver, gold, etc.
  stockAmount       Float
  cloudBalance      Float
  maxBalance        Float
  period            Int      // 模拟周期（天）
  totalProfit       Float    // 总利润
  totalRevenue      Float    // 总销售额
  dailyProfitData   Json     // 每日利润数据（JSON数组）
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([userId])
  @@index([level])
  @@index([createdAt])
}

// 店铺等级配置表（动态可修改）
model ShopLevelConfig {
  id               String   @id @default(cuid())
  level            String   @unique // bronze, silver, gold, etc.
  name             String   // 青铜店长, 白银店长, etc.
  minStock         Int      // 最小进货额度
  maxStock         Int      // 最大进货额度
  commissionRate   Float    // 佣金费率
  stockDiscount    Float    // 进货折扣
  saleDiscount     Float    // 销售折扣
  color            String   // 颜色代码
  completionDays   Int      // 预计完成天数
  settlementDays   Int      // 结算周期（天）
  settlementDiscount Float // 结算折扣
  sellRatio        Float    // 卖出比例
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([level])
}

// 福利表
model Benefit {
  id          String   @id @default(cuid())
  title       String   // 福利标题
  category    String   // newbie, community, platform, wechat, buxin
  description String   @db.Text
  requirements String? @db.Text // 领取要求
  content     String   @db.Text // 福利内容详情（JSON格式）
  priority    Int      @default(0) // 排序优先级
  isActive    Boolean  @default(true)
  startDate   DateTime?
  endDate     DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@index([isActive])
}

// 公告表
model Announcement {
  id          String   @id @default(cuid())
  title       String   // 公告标题
  content     String   @db.Text // 公告内容
  type        String   @default("info") // info, warning, success, error
  priority    Int      @default(0) // 排序优先级
  isActive    Boolean  @default(true)
  isPinned    Boolean  @default(false) // 是否置顶
  startDate   DateTime?
  endDate     DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
  @@index([isPinned])
  @@index([createdAt])
}

// 用户奖励领取记录表
model UserReward {
  id          String   @id @default(cuid())
  userId      String   // 关联用户ID
  benefitId   String   // 福利ID
  benefit     Benefit? @relation(fields: [benefitId], references: [id], onDelete: Cascade)
  status      String   @default("pending") // pending, approved, claimed, rejected
  note        String?  // 备注信息
  adminId     String?  // 审核管理员ID
  claimedAt   DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@index([benefitId])
  @@index([status])
}

// 系统日志表
model SystemLog {
  id        String   @id @default(cuid())
  adminId   String?
  action    String   // 操作类型
  resource  String   // 操作资源
  details   String   @db.Text // 操作详情
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())

  @@index([adminId])
  @@index([createdAt])
}
